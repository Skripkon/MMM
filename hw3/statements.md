# ДЗ №3 Атаки на мультимодальные модели

Вы работаете в R&D-подразделении, которое отвечает за разработку и качество мультимодальных моделей.

Модели уже используются в продукте, и вы хотите понять, насколько их легко обмануть с помощью текста, нарисованного на изображении, чтобы, например, подсунуть в поисковую или рекомендательную выдачу нерелевантный товар и как выглядят более продвинутые мультимодальные атаки, незаметные человеку.

В этом ДЗ нужно реализовать и проанализировать **типографическую атаку** на энкодеры и VLM, а также познакомиться с подходом **M-Attack**.

---

## Исходные данные

В качестве данных для экспериментов вы можете использовать сэмпл данных из :

* набора из ДЗ №2;
* датасета с парами текст - изображение

Размер поднабора для экспериментов — **не менее 50–100 изображений**.  
Вы сами выбираете подмножество так, чтобы оно было осмысленным для анализа атак.

---

## Часть 1. Типографическая атака на энкодер и VLM

В этой части вы строите атаку, при которой к изображению дорисовывается текст (надпись), и модель начинает «верить» этой надписи. В качестве энкодера вы можете взять CLIP, SigLIP и другие модели. Подумайте, какие модели должны участвовать в корректном сравнении поведения энкодеров и VLM.

1. **Автоматизированный подбор нерелевантных текстов.**
   * Для каждого изображения с известным релевантным лейблом сгенерируйте несколько нерелевантных текстов-кандидатов.
   * Выберите тексты, которые **максимально далеки** от изображения. 
   Обязательно опишите как делали каждый из этапов и почему именно так реализовывали его. 

2. **Нанесение текста на изображение.**
   * Реализуйте функцию, которая рисует выбранный текст поверх изображения.
   * Сформируйте атакованные версии изображений с разными текстами, позициями/размерами/шрифтами и т.д.

3. **Оценка влияния.**
   * Для каждой картинки постройте визуализации, покажите, как часто картинка становится ближе к тексту атаки, чем к оригинальному описанию, предложите метрики для оценки эффекта. 

4. **Оценка влияния на VLM.**
   * Изображение исходных и атакованных картинок прогоните через выбранную VLM.
   * Сравните описания до и после атаки, предложите **дешевую эвристику** метрики силы атаки.

Сделайте краткий анализ:
* когда атака работает лучше/хуже;
* на каких типах картинок модель особенно уязвима.

---

## Часть 2. M-Attack

В этой части вы знакомитесь с более сложным методом атак на мультимодальные модели — **M-Attack**.

1. Ознакомьтесь с материалом лекции и репозиторием `https://github.com/VILA-Lab/M-Attack` и его идеей (ensemble surrogate-моделей, matching и т.д.). Вы можете переиспользовать код из репозитория и имплементировать самостоятельную реализацию.
2. апустите атаку на 1–3 изображениях. Покажите изображения до/после атаки. Прогоните через выбранные вами модели, аргументируя выбор этих моделей на всех этапах экспериментов. 
3. Посчитайте метрики и сравните с результатами типографической атаки.
4. Попробуйте скомбинировать атаки и поэксперементировать с сетапами атаки, параметрами на различных этапах.

Сделайте анализ:
* чем M-Attack принципиально отличается от вашей атаки из первой части;
* какие trade-off’ы видите между силой атаки, вычислительной стоимостью и визуальной заметностью изменений;
* как гиперпараметры атаки влияют на результат;
* насколько атака переносима с модели на модель.


---

## Формат работы

* Выполняйте шаги в ноутбуке. Если часть реализована в отдельных скриптах или нескольких ноутбуках - загрузите в качестве решения все артефакты.
* Все визуализации (графики, таблицы, примеры товаров) должны быть в ноутбуке.
* Каждый блок должен содержать краткое пояснение в Markdown.
* Код должен быть воспроизводимым (укажите seed, версии библиотек и используемые модели).

---

## Критерии оценивания

| Компонент                                                       | Баллы |
|-----------------------------------------------------------------|:-----:|
| Реализация и анализ типографической атаки на энкодер          | 4     |
| Реализация и анализ типографической атаки на VLM             | 3     |
| Реализация и анализ M-Attack                | 3     |
| **Максимум**                                                    | **10**|

